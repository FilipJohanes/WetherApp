# MVP Execution Plan

---

## Overview

Your product now has two user-facing surfaces:

- **Email-driven weather subscription engine**
  - Subscribe, update, unsubscribe by email
  - Personality + language modes
  - Daily forecast at user‚Äôs local 05:00
  - Real-time email parsing via IMAP IDLE

- **Secure Flask web interface**
  - Subscribe / Unsubscribe forms
  - Weather preview page
  - Stats page
  - Public API endpoints (check-email)
  - CSRF protection, rate limiting, SQL injection prevention

This means your MVP isn‚Äôt ‚Äúemail-only‚Äù anymore ‚Äî it‚Äôs a dual-channel weather service with real-time commands + a secure onboarding web app.

This roadmap reflects that full scope.

---

## 0. MVP Scope Definition

### Final MVP Feature Set

**Email Engine (core):**
- Users subscribe by emailing location.
- Users can unsubscribe anytime.
- Multi-language & personality modes.
- Daily weather sent at 05:00 local time.
- Real-time email ingestion (IMAP IDLE).
- Geocoding, timezone inference, email templates.
- Strong command parsing (location, language, personality).

**Web App (secondary user surface):**
- Subscribe via secure web form (validates email, location, language, personality).
- Unsubscribe form.
- Weather preview.
- Public stats (non-sensitive).
- Public API endpoint: `/api/check-email` to check subscription status.

**Out of Scope for MVP:**
- Calendar reminders.
- Multi-city support.
- Mobile push/SMS notifications.
- User accounts / logins.
- UI dashboard for users.

> Write this down in `MVP_SCOPE.md` so the project stays aligned.

---

## Week 1 ‚Äî Stabilize Backend & Synchronize Web + Email Logic

### Step 1 ‚Äî Fix Structural Issues Across Both Apps

üîí **Remove password logging (critical)**
- In `app.py`, fix IMAP/SMTP login logs.
- Replace lines like:
  - `logger.info(f"üîê Attempting IMAP login - Email: {config.email_address}, Password: {config.email_password}")`
- With:
  - `logger.info(f"üîê Attempting IMAP login - Email: {config.email_address}")`
- Do the same in SMTP login.

üîí **Align licensing between apps**
- Top of `app.py` says proprietary.
- README created by `create_readme_if_missing()` says Open source.
- Fix README template to reflect proprietary beta.

üßº **Remove calendar references everywhere**
- `_get_usage_footer()`
- README
- Landing page copy (later)
- No mention of reminders in UI or API.

### Step 2 ‚Äî Unify Subscription Logic (Email + Web)

Right now logic is duplicated:
- Web app: inserts/updates subscribers
- Email engine: inserts/updates subscribers

You should:
- Create a shared subscription module: `services/subscription_service.py`
- Move duplicate logic there (insert/update/delete).
- Replace DB code in both apps with calls to the module.

> This is not required for MVP functionality‚Äîbut crucial for correctness, maintainability, and future scaling.

### Step 3 ‚Äî Test Harness for Email Engine

Create `/scripts`:
- `test_subscribe_flow.py`
  - Simulates inbound email ‚Üí ensures DB updates and log output.
- `test_unsubscribe_flow.py`
  - Confirms DELETE flow works.
- `test_parsing_modes.py`
  - Verifies:
    - "brutal"
    - "Madrid es cute"
    - "language sk"
    - "Prague sk emuska"
- `test_daily_weather_job.py`
  - Use `now_override` to simulate 05:00 in user‚Äôs timezone.

### Step 4 ‚Äî Test Harness for Web App

Create these scripts:
- `test_web_subscribe.py`
  - POST `/subscribe` with sample data.
  - Verify DB row exists.
  - Check redirect to `/preview`.
- `test_web_unsubscribe.py`
  - POST `/unsubscribe`.
  - Verify row is removed.
- `test_preview_route.py`
  - GET `/preview?email=...`
  - Should show rendered forecast.
- `test_api_check_email.py`
  - POST `/api/check-email={"email": "..."}`
  - Expects correct JSON.

### Step 5 ‚Äî Consolidate Database Schema

Ensure the following fields exist and are unified:

**For email engine:**
- email
- location
- lat
- lon
- timezone
- updated_at
- personality
- language
- last_sent_date

**For web app:**
- Ensure it expects exactly same columns.
- Check any mismatch in defaults (e.g., timezone, language).

Enforce schema consistency:
- Run `init_db()` once at startup in both apps.
- Or create `db_migration.py` and run it manually during deployment.

---

## Week 2 ‚Äî UX, Deliverability & Web Security

### Step 6 ‚Äî Deployment-Grade Email Deliverability

**Domain & DNS:**
- Set up SPF.
- Set up DKIM.
- (Optional) Set up DMARC (monitor mode).

Send test emails to:
- Gmail
- Outlook
- Protonmail
- Yahoo

Record:
- whether they land in Inbox or Spam
- what headers the providers show (DKIM pass/fail, SPF pass/fail)

Fix any issues before real users sign up.

### Step 7 ‚Äî Polish Web UX

Check for missing templates:
- Ensure all referenced template files exist:
  - index.html
  - subscribe.html
  - unsubscribe.html
  - preview.html
  - stats.html
  - error.html

Improve copy:
- Explain how the email engine works.
- Show a sample email in the UI.
- Clarify personality modes and language effects.

Add footer disclaimers:
- Data stored (email + location).
- How to unsubscribe.
- Beta in testing.
- Contact email for bugs.

### Step 8 ‚Äî Monitoring & Logging

Improve logs in both apps:
- Add:
  - Event-level logs (subscribe, unsubscribe, preview load).
  - Counts of daily emails sent.
  - Geocoding failure patterns.
- Add file rotation
  - Use `logging.handlers.RotatingFileHandler` so `web_app.log` and `app.log` don‚Äôt grow infinitely.
  - (this can be post-launch)

### Step 9 ‚Äî Build Internal Metrics Page (Optional)

Extend `/stats` page:
- Subscribe counts per day.
- Top 10 locations.
- Personality distribution.
- Language distribution.

This helps understand early usage.

---

## Week 3 ‚Äî Closed Beta With Real Users

### Step 10 ‚Äî Prepare Beta Test Kit

Create `BETA_INSTRUCTIONS.md`:
- Should include:
  - What the product does.
  - Example subscription emails:
    - "Bratislava"
    - "Madrid es cute"
    - "Prague sk emuska"
  - Link to the web subscribe form.
  - How to unsubscribe.
  - What to do if:
    - random errors occur,
    - location not found,
    - email not received.

### Step 11 ‚Äî Run 5‚Äì10 Person Closed Beta

Steps:
- Invite users to either:
  - subscribe via email OR
  - subscribe via web form.
- Ask them to:
  - Try multiple personalities.
  - Change languages.
  - Change location.
  - Unsubscribe/re-subscribe.
  - Try invalid input on web form.
  - Try preview page.

Observe:
- Spam folder issues.
- Whether 5AM logic works across timezones.
- Parsing failures.
- Mismatched behavior between web and email subscription.

### Step 12 ‚Äî Collect Feedback

Add a subtle line to all weather emails:
- ‚ÄúFound an issue? Reply with feedback: YOUR MESSAGE.‚Äù

Create a minimal handler:
- For MVP: just let replies land in your inbox.
- For v1.1: add parsing + storage in SQLite.

### Step 13 ‚Äî Triage & Prioritize

Fix high-severity issues:
- Incorrect geocoding.
- Wrong timezone.
- Duplicate emails.
- Daily report not being sent.
- Web validation errors.
- Web vs email inconsistencies.

---

## Week 4 ‚Äî Post-MVP Strategy

**Option A ‚Äî Strengthen Email Engine**
- Multiple send times.
- Weekend mode.
- Multi-city support.
- Per-user forecast depths (hourly/daily).

**Option B ‚Äî Expand Web Interface**
- User login.
- Preferences dashboard.
- Multi-location management.
- Email history.

**Option C ‚Äî Bring Back Calendar Reminders**
- Clean architecture around scheduling.
- Better templates.
- Optional timezone-specific scheduling.

---

## Final Notes

Your architecture is already strong:
- Email engine = automated, reliable, timezone-aware
- Web app = secure, validated, rate-limited, user-friendly
- Database = lightweight but functional
- Weather system = Open-Meteo (free, stable)

This roadmap ensures the project becomes a polished, real-world MVP that:
- users can subscribe to safely,
- receives weather reports reliably,
- doesn‚Äôt leak credentials,
- is maintainable,
- and scales to the next stage.